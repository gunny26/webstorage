# on ubuntu 14.04.x or debian jessie
#
# first install apache2
sudo apt-get install apache2
# next install wsgi for python 2.x
sudo apt-get install libapache2-mod-wsgi
# and next web.py
sudo apt-get install python-webpy
# next configure default site or every other NameVirtualHost
# to start wsgi applications
# something like this

    # BlockStorage Application    
    WSGIDaemonProcess blockstorage processes=1 threads=10
    WSGIScriptAlias /blockstorage /var/www/webstorage/webapps/blockstorage/code.py
    WSGIProcessGroup blockstorage
    # FileStorage Application    
    WSGIDaemonProcess filestorage processes=1 threads=10
    WSGIScriptAlias /filestorage /var/www/webstorage/webapps/filestorage/code.py

# additional optimize apache for minimal memory usage
# not all lines are available on ubuntu and debian
sudo a2dismod -f authn_file
sudo a2dismod -f authz_host
sudo a2dismod -f authz_user
sudo a2dismod -f autoindex
sudo a2dismod -f deflate
sudo a2dismod -f dir
sudo a2dismod -f env
sudo a2dismod -f filter
sudo a2dismod -f negotiation
sudo a2dismod -f setenvif
sudo a2dismod -f status
sudo a2dismod -f alias
sudo a2dismod -f mime
sudo a2disconf javascript-common
sudo a2disconf localized-error-pages
sudo a2disconf serve-cgi-bin
sudo apache2ctl restart # to see error messages
sudo service apache2 restart

# at last define some directories to store data
# these dierctory must be fully accessible for the webserver user
# on my example server i mounted /dev/sda on /media/webstorage
export WEBSTORAGE=/path/to/directory
mkdir $WEBSTORAGE
mount /big/block/device $WEBSTORAGE
mkdir $WEBSTORAGE/blockstorage
chown www-run $WEBSTORAGE/blockstorage
mkdir $WEBSTORAGE/filestorage
chown www-run $WEBSTORAGE/filestorage

# for singning webstorage archives, create private/public key pair
openssl genrsa -out private.der 4096
openssl rsa -in private.der -pubout -out public.der
# for signing the private key is needed

